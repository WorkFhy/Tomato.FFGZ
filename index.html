<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tomato Quality Control</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet">

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap");

        :root {
            --br: 20px;
            --neon-green: #39ff14;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #ffffff;
            margin: 0;
        }

        .navbar {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .navbar-brand {
            color: var(--neon-green);
            font-size: 1.3rem;
            font-weight: bold;
        }

        .nav-link {
            color: #fff !important;
        }

        .card-custom {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 1rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            backdrop-filter: blur(7px);
            -webkit-backdrop-filter: blur(7px);
            transition: transform 0.3s;
        }

        .card-custom:hover {
            transform: translateY(-5px);
        }

        .photo {
            width: 100%;
            border-radius: 0.75rem;
            object-fit: cover;
            margin-bottom: 1rem;
        }

        .team-container h1,
        .text-light,
        .card-custom h5 {
            color: var(--neon-green);
        }

        .card-team {
            width: 240px;
            background: var(--glass-bg);
            padding: 15px;
            border-radius: var(--br);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(8px);
            color: #fff;
        }

        .card-team:hover {
            box-shadow: 0px 3px 15px 5px #00ffcc44;
        }

        .card-team img {
            max-width: 100%;
            border-radius: 50%;
            aspect-ratio: 1 / 1;
            border: 4px solid var(--bc, var(--neon-green));
        }

        .card-team a {
            background: var(--btn, var(--neon-green));
            color: #000;
            padding: 10px 15px;
            border-radius: var(--br);
            text-decoration: none;
            margin-top: 15px;
            display: block;
            font-weight: bold;
        }

        .status-output {
            font-size: 1.3rem;
            padding: 0.8rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: bold;
            margin-top: 1rem;
        }

        .output-bagus {
            background-color: #00ff00aa;
            color: #000;
        }

        .output-baik {
            background-color: #ffff00aa;
            color: #000;
        }

        .output-buruk {
            background-color: #ff0000aa;
            color: #fff;
        }

        .table-dark {
            background-color: #111;
            color: var(--neon-green);
        }

        .table tbody tr {
            background-color: rgba(255, 255, 255, 0.05);
        }

        #timestamp-display {
            background-color: var(--neon-green);
            color: #000;
        }

        .title {
            text-align: center;
            text-transform: capitalize;
            color: #726a95;
            margin: 10px 0;
            position: relative;
        }

        .title::after {
            content: "";
            position: absolute;
            width: 20%;
            height: 2px;
            background-image: linear-gradient(to left, transparent 5%, #726a95);
            bottom: -10px;
            left: 50%;
            transform: translate(-50%);
        }

        .team-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 40px 0;
        }

        .member {
            flex: 1 1 250px;
            margin: 20px;
            text-align: center;
            padding: 20px 10px;
            cursor: pointer;
            max-width: 300px;
            transition: all 0.3s;
        }

        .member:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-20px);
        }

        .member img {
            display: block;
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 4px solid #726a95;
            border-radius: 50%;
            margin: 0 auto;
        }

        .member h2 {
            text-transform: uppercase;
            font-size: 24px;
            color: #726a95;
            margin: 15px 0;
        }

        .member p {
            font-size: 15px;
            color: #feffff;
            line-height: 1.6;
        }

        .project-description {
            font-size: 0.95rem;
            color: #c2f0c2;
            background: rgba(0, 255, 100, 0.05);
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            margin-top: 1rem;
            font-family: 'Orbitron', sans-serif;
            text-align: left;
        }

        .project-description ol {
            padding-left: 1.2rem;
        }

        .project-description li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark navbar-expand-lg sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Tomato Quality Control With Fuzzy Logic üçÖ</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="tampilkanHistory()">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="tampilkanTeam()">Team</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="tampilkanRuleFuzzy()">Rule Fuzzy</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
        <div class="row g-4">

            <!-- Team Section -->
            <div id="team-section" style="display: none;">
                <section>
                    <h1 class="title">our team</h1>
                    <div class="team-row">
                        <div class="member">
                            <img src="https://i.imgur.com/s6ihBVC.jpeg" alt="Team Member" />
                            <h2>Zidan Tawakal Nur Effendi</h2>
                            <p>üß† The Brain Behind the Report and Concept <p><p>
                                Zidan is the mastermind of all project ideas, report structures, and documentation. He ensures everything starts with a solid plan and a clear vision.
                            </p>
                        </div>
                        <div class="member">
                            <img src="https://i.imgur.com/55Oqh7r.jpeg" alt="Team Member" />
                            <h2>Muhammad Garis Halilul</h2>
                            <p>üé® Design & Component Strategist <p> <p>Garis is the creative force for poster designs and visual assets. He also manages component sourcing and supports the team‚Äôs resource logistics.
                            </p>
                        </div>
                        <div class="member">
                            <img src="https://i.imgur.com/iq6D6gO.jpeg" alt="Team Member" />
                            <h2>Fauzan Akbar Purnawan</h2>
                            <p>üõ†Ô∏è Backend & System Architect <p><p>Fauzan builds the system‚Äôs backbone ‚Äî from Firebase integration to web backend and all the wiring. The technical core relies on his precision and code.
                            </p>
                        </div>
                        <div class="member">
                            <img src="https://i.imgur.com/H2Dh7wh.jpeg" alt="Team Member" />
                            <h2>Fahmay Rizal Audiansyah</h2>
                            <p>‚öôÔ∏è Mechanical Framework Expert <p><p>Fahmay designs and builds the physical frame and all mechanical systems involved. Every moving part is the result of his engineering skills.
                            </p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Rule Fuzzy Section -->
            <div id="rule-fuzzy-section" style="display: none;">
                <h2 class="text-center mb-4 text-light">üìò Daftar Rule Fuzzy</h2>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped table-hover bg-white">
                        <thead class="table-dark text-center">
                            <tr>
                                <th>#</th>
                                <th>Warna</th>
                                <th>Ukuran (gram)</th>
                                <th>Output</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Hijau</td>
                                <td>60 - 85</td>
                                <td>Buruk</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Hijau</td>
                                <td>90 - 120</td>
                                <td>Buruk</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Hijau</td>
                                <td>lainnya</td>
                                <td>Sedang</td>
                            </tr>

                            <tr>
                                <td>4</td>
                                <td>Kuning</td>
                                <td>60 - 85</td>
                                <td>Buruk</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>Kuning</td>
                                <td>90 - 120</td>
                                <td>Sedang</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>Kuning</td>
                                <td>lainnya</td>
                                <td>Sedang</td>
                            </tr>

                            <tr>
                                <td>7</td>
                                <td>Merah</td>
                                <td>60 - 85</td>
                                <td>Sedang</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>Merah</td>
                                <td>90 - 120</td>
                                <td>Bagus</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td>Merah</td>
                                <td>lainnya</td>
                                <td>Bagus</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboard-content">
                <div class="row g-4">
                    <div class="col-md-6 col-lg-4">
                        <div class="card-custom">
                            <h5 class="mb-3">üßë‚Äçü§ù‚Äçüßë Team Photo</h5>
                            <img src="https://i.imgur.com/tlCAyyv.jpeg" alt="Team Photo" class="photo" />
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4">
                        <div class="card-custom">
                            <h5 class="mb-3">üì∑ Project Photo</h5>
                            <img src="https://i.imgur.com/lzFpFvp.jpeg" alt="Project Photo" class="photo" />
                            <div class="project-description">
                                <h3><strong>Cara Kerja</strong></h3>
                                <ol>
                                    <li>Tahap <strong>Input Data</strong> yaitu penempatan tomat ke dalam alat.</li>
                                    <li><strong>Deteksi Berat</strong> menggunakan sensor berat dan motor servo untuk
                                        akurasi.</li>
                                    <li><strong>Deteksi Warna</strong> oleh sensor TCS dan LED pencahayaan optimal.</li>
                                    <li><strong>Fuzzifikasi</strong>: data diubah jadi derajat keanggotaan dalam
                                        himpunan fuzzy.</li>
                                    <li><strong>Inferensi Fuzzy</strong>: aturan "JIKA-MAKA" menentukan kualitas tomat.
                                    </li>
                                    <li><strong>Defuzzifikasi</strong>: hasil fuzzy dikonversi ke tindakan nyata (gerak
                                        servo).</li>
                                </ol>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4">
                        <div class="card-custom">
                            <h5 class="mb-3">üß™ Sensor Parameters</h5>
                            <div class="param">‚öñÔ∏è Weight: <span id="berat"
                                    class="fw-semibold text-primary">Loading...</span></div>
                            <div class="param">üé® Color: <span id="warna"
                                    class="fw-semibold text-primary">Loading...</span></div>
                            <div id="status-output" class="status-output output-baik">Loading quality...</div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-4">
                        <div class="card-custom text-center">
                            <h5 class="mb-3">üß≠ Current Timestamp</h5>
                            <div id="timestamp-display"
                                style="font-size: 1.3rem; font-weight: bold; padding: 0.8rem; border-radius: 0.5rem; background-color: #0d6efd; color: white;">
                                Loading time...
                            </div>
                        </div>
                    </div>
                    <!-- Tabel Jumlah Kualitas -->
                    <div class="card shadow-sm rounded p-3 mb-4" style="max-width: 500px;">
                        <h5><i class="ri-bar-chart-box-line"></i> Jumlah Kualitas Tomat</h5>
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-striped text-center">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Kualitas</th>
                                        <th>Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="jumlah-kualitas-body">
                                    <tr>
                                        <td>Bagus</td>
                                        <td id="count-bagus">0</td>
                                    </tr>
                                    <tr>
                                        <td>Sedang</td>
                                        <td id="count-sedang">0</td>
                                    </tr>
                                    <tr>
                                        <td>Buruk</td>
                                        <td id="count-buruk">0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>



                    <div class="card shadow-sm rounded p-3">
                        <h5>
                            <i class="bi bi-bar-chart-line"></i> History Pembacaan
                        </h5>
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-striped table-hover table-bordered text-center">
                                <thead class="table-dark">
                                    <tr>
                                        <th><i class="bi bi-clock"></i> Timestamp</th>
                                        <th><i class="bi bi-speedometer"></i> Berat (g)</th>
                                        <th><i class="bi bi-palette"></i> Warna</th>
                                        <th><i class="bi bi-star-half"></i> Kualitas</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <tr>
                                        <td colspan="4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div> <!-- end row -->
            </div> <!-- end dashboard-content -->
            <!-- end dashboard-content -->

        </div>
    </div>


    <script>
        function hitungJumlahKualitas() {
            const rows = document.querySelectorAll("#history-table-body tr");
            let bagus = 0, sedang = 0, buruk = 0;

            rows.forEach(row => {
                const kualitasCell = row.cells[3];
                if (kualitasCell) {
                    const kualitas = kualitasCell.textContent.trim().toLowerCase();
                    if (kualitas === "bagus") bagus++;
                    else if (kualitas === "sedang") sedang++;
                    else if (kualitas === "buruk") buruk++;
                }
            });

            document.getElementById("count-bagus").textContent = bagus;
            document.getElementById("count-sedang").textContent = sedang;
            document.getElementById("count-buruk").textContent = buruk;
        }

        // Hitung saat halaman dimuat dan setiap 2 detik untuk pembaruan otomatis
        document.addEventListener("DOMContentLoaded", hitungJumlahKualitas);
        setInterval(hitungJumlahKualitas, 2000);
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Script -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB3f0RKRCKaDoVc8QJHoy7hGfaNMw3L7FY",
            authDomain: "kontolodon-92b4a.firebaseapp.com",
            databaseURL: "https://zannrepo-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "zannrepo",
            storageBucket: "zannrepo.appspot.com",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function bacaDataTomat() {
            db.ref("data_tomat").on("value", (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById("berat").textContent = data.berat + " grams";
                    document.getElementById("warna").textContent = data.warna;

                    // Update kualitas real-time
                    const outputDiv = document.getElementById("status-output");
                    outputDiv.textContent = data.kualitas || "Tidak diketahui";

                    // Tambahkan class styling berdasarkan kualitas
                    outputDiv.classList.remove("output-bagus", "output-baik", "output-buruk");

                    if (data.kualitas === "Bagus") {
                        outputDiv.classList.add("output-bagus");
                    } else if (data.kualitas === "Baik") {
                        outputDiv.classList.add("output-baik");
                    } else if (data.kualitas === "Buruk") {
                        outputDiv.classList.add("output-buruk");
                    }
                }
            });
        }


        function bacaHistoryTomat() {
            const historyRef = db.ref("history_tomat").limitToLast(20);
            historyRef.on("value", (snapshot) => {
                const data = snapshot.val();
                const tbody = document.getElementById("history-body");
                tbody.innerHTML = "";

                if (data) {
                    const entries = Object.entries(data).sort((a, b) => b[0].localeCompare(a[0]));
                    entries.forEach(([timestamp, record]) => {
                        tbody.innerHTML += `
              <tr>
                <td>${timestamp}</td>
                <td>${record.berat}</td>
                <td>${record.warna}</td>
                <td>${record.kualitas}</td>
              </tr>`;
                    });
                } else {
                    tbody.innerHTML = "<tr><td colspan='4' class='text-center'>Tidak ada data.</td></tr>";
                }
            });
        }
        function updateTimestamp() {
            const now = new Date();

            // Konversi ke WIB (GMT+7)
            const wibOffset = 7 * 60; // dalam menit
            const localUTCOffset = now.getTimezoneOffset(); // dalam menit
            const wibTime = new Date(now.getTime() + (wibOffset + localUTCOffset) * 60000);

            // Format jam saja (tanpa tanggal)
            const formatted = wibTime.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }) + " WIB";

            document.getElementById('timestamp-display').textContent = formatted;
        }


        window.onload = function () {
            bacaDataTomat();
            bacaHistoryTomat();
            updateTimestamp(); // panggil sekali saat load
            setInterval(updateTimestamp, 1000); // update setiap detik
        };
        function tampilkanHistory() {
            document.getElementById("dashboard-content").style.display = "block";
            document.getElementById("team-section").style.display = "none";
            document.getElementById("rule-fuzzy-section").style.display = "none";
        }

        function tampilkanTeam() {
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("team-section").style.display = "block";
            document.getElementById("rule-fuzzy-section").style.display = "none";
        }

        function tampilkanRuleFuzzy() {
            document.getElementById("dashboard-content").style.display = "none";
            document.getElementById("team-section").style.display = "none";
            document.getElementById("rule-fuzzy-section").style.display = "block";
        }

        window.onload = function () {
            bacaDataTomat();
            bacaHistoryTomat();
            updateTimestamp();
            setInterval(updateTimestamp, 1000); // update setiap detik
        };
        function muatHistory() {
            const historyTable = document.getElementById("history-table-body");
            historyTable.innerHTML = `
        <tr>
          <td colspan="4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </td>
        </tr>
      `;

            db.ref("history").limitToLast(50).on("value", (snapshot) => {
                const data = snapshot.val();
                historyTable.innerHTML = ""; // Kosongkan isi tabel dulu

                if (data) {
                    const keys = Object.keys(data).reverse(); // Biar data terbaru di atas
                    keys.forEach((key) => {
                        const item = data[key];
                        const row = document.createElement("tr");

                        row.innerHTML = `
              <td>${item.timestamp || "-"}</td>
              <td>${item.berat || "-"} g</td>
              <td>${item.warna || "-"}</td>
              <td>${item.kualitas || "-"}</td>
            `;
                        historyTable.appendChild(row);
                    });
                } else {
                    historyTable.innerHTML = `
            <tr>
              <td colspan="4">Tidak ada data history.</td>
            </tr>
          `;
                }
            });
        }

        // Panggil saat halaman dimuat
        window.addEventListener("load", () => {
            bacaDataTomat();
            muatHistory();
        });

    </script>
</body>

</html>
